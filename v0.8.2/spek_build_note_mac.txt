#install dependencies
brew install automake coreutils intltool

#need to use ffmpeg 4 for using avcodec_decode_audio4
brew install ffmpeg@4

#install wxwidgets
brew install wxwidgets

#set path for finding the file wxwin.m4
#https://github.com/Homebrew/homebrew-core/commit/f5e3982c5c1f83906ba3f8aef422dda3e5a1dda0
find $(brew --cellar wxwidgets) -name "wxwin.m4" -exec ln -s {} /usr/local/share/aclocal/wxwin.m4 \;

#get source (spek)
git clone https://github.com/alexkay/spek.git
cd spek
git checkout f071c29

#get source (spek-alternative)
git clone https://github.com/withmorten/spek-alternative.git
cd spek-alternative
git checkout 0.8.2.3

#update /etc/ssl/cert.pem
https://curl.se/docs/caextract.html
download cacert.pem
rename it to /etc/ssl/cert.pem

#install perl module XML::Parser
cpan install XML::Parser

#Fix libbrotli loader_path
sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "/usr/local/lib/libbrotlicommon.1.dylib" /usr/local/lib/libbrotlidec.1.dylib
sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "/usr/local/lib/libbrotlicommon.1.dylib" /usr/local/lib/libbrotlienc.1.dylib

#build
./dist/osx/bundle.sh

#run
./dist/osx/Spek.app/Contents/MacOS/Spek

#the dmg file
./dist/osx/Spek.dmg
